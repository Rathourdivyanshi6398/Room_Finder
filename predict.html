<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rental Price Predictor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="predict.css">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Navbar -->
  <nav class="sidebar">
    <div>
      <a href="#" class="logo">
        <i class="fas fa-door-open"></i>
        <span class="nav-text">Room Finder</span>
      </a>
    </div>
    <div class="nav-links">
      <a href="index.html" class="nav-item">
        <i class="fas fa-home"></i>
        <span class="nav-text">Home</span>
      </a>
      <a href="analysis.html" class="nav-item">
        <i class="fas fa-users"></i>
        <span class="nav-text">Analysis</span>
      </a>
      <a href="predict.html" class="nav-item">
        <i class="fas fa-info-circle"></i>
        <span class="nav-text">Predictor</span>
      </a>
      <a href="about.html" class="nav-item">
        <i class="fas fa-envelope"></i>
        <span class="nav-text">About</span>
      </a>
    </div>
  </nav>
    <!-- Hero Section -->
    <div class="predictor-hero" id="pridict">
        <div class="predictor-hero-content">
            <h1>Room Rent <span class="accent">Predictor</span></h1>
            <p>Get an accurate estimate of how much you should charge for your property</p>
        </div>
    </div>

    <!-- Predictor Form Section -->
    <div class="predictor-container">
        <div class="form-container" id="formContainer">
            <h2>Enter Your Property Details</h2>
            <p class="form-subtitle">Fill in the details below to get an estimated rental price</p>

            <form id="predictionForm" class="predictor-form">
                <div class="form-group">
                    <label for="city">
                        <i class="fas fa-city"></i> City
                    </label>
                    <select id="city" name="city" required>
                        <option value="" disabled selected>Select city...</option>
                        <option value="Lucknow">Lucknow</option>
                        <option value="Noida">Noida</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="location">
                        <i class="fas fa-map-marker-alt"></i> Location
                    </label>
                    <select id="location" name="location" required disabled>
                        <option value="" disabled selected>Select location...</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="bhk">
                            <i class="fas fa-building"></i> BHK
                        </label>
                        <select id="bhk" name="bhk" required>
                            <option value="" disabled selected>Select BHK...</option>
                            <option value="1">1 BHK</option>
                            <option value="2">2 BHK</option>
                            <option value="3">3 BHK</option>
                            <option value="4">4 BHK</option>
                            <option value="5">5 BHK</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="area">
                            <i class="fas fa-ruler-combined"></i> Area (sq.ft)
                        </label>
                        <input type="number" id="area" name="area" min="1" placeholder="e.g., 1200" required>
                    </div>
                </div>

                <button type="submit" class="predict-btn" id="predictBtn">
                    <i class="fas fa-calculator"></i> Calculate Rent
                </button>
            </form>
        </div>

        <!-- Results Container -->
        <div class="results-container" id="resultsContainer" style="display: none;">
            <div class="results-card">
                <div class="results-header">
                    <h2>Your Estimated Rental Price</h2>
                    <p class="results-subtitle">Based on current market trends and similar properties</p>
                </div>

                <div class="price-display">
                    <span class="currency">â‚¹</span>
                    <span class="price" id="predictedPrice">0</span>
                    <span class="period">/month</span>
                </div>

                <div class="price-breakdown">
                    <h3>Price Breakdown</h3>
                    <ul id="priceFactors">
                        <li>
                            <span class="factor-name">City</span>
                            <span class="factor-value" id="resultCity"></span>
                        </li>
                        <li>
                            <span class="factor-name">Location</span>
                            <span class="factor-value" id="resultLocation"></span>
                        </li>
                        <li>
                            <span class="factor-name">BHK</span>
                            <span class="factor-value" id="resultBHK"></span>
                        </li>
                        <li>
                            <span class="factor-name">Area</span>
                            <span class="factor-value" id="resultArea"></span>
                        </li>
                    </ul>
                </div>

                <div class="insights">
                    <p>This estimate is based on similar properties in your area. Actual rental values may vary based on
                        additional factors like proximity to public transport, demand, and property condition.</p>
                </div>

                <button id="predictAgainBtn" class="predict-again-btn">
                    <i class="fas fa-redo"></i> Predict Again
                </button>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            let locations = {};

            // Load locations data
            $.ajax({
                url: 'locations.json',
                dataType: 'json',
                success: function (data) {
                    locations = data;
                    console.log('Locations loaded successfully');
                },
                error: function (xhr, status, error) {
                    console.error('Error loading locations:', error);
                    alert('Error loading location data. Please refresh the page.');
                }
            });

            // Update locations when city changes
            $('#city').change(function () {
                const city = $(this).val();
                const locationSelect = $('#location');

                // Clear and disable location dropdown
                locationSelect.empty().prop('disabled', true);
                locationSelect.append('<option value="" disabled selected>Select location...</option>');

                if (city && locations[city]) {
                    // Add locations for selected city
                    locations[city].forEach(location => {
                        locationSelect.append(`<option value="${location}">${location}</option>`);
                    });
                    locationSelect.prop('disabled', false);
                }
            });

            // Updated AJAX call with validation
            $('#predictionForm').on('submit', function (e) {
                e.preventDefault();

                // Hide previous results and errors
                $('#resultsContainer').hide();
                $('.loading').show();

                // Get form data
                var formData = {
                    city: $('#city').val(),
                    location: $('#location').val(),
                    bhk: parseInt($('#bhk').val()),
                    area: parseFloat($('#area').val())
                };

                // Client-side validation
                if (!formData.city || !formData.location || !$('#bhk').val() || !$('#area').val()) {
                    alert('Please fill all required fields');
                    $('.loading').hide();
                    return;
                }

                if (formData.bhk < 1) {
                    alert('BHK must be at least 1');
                    $('.loading').hide();
                    return;
                }

                if (formData.area <= 0) {
                    alert('Area must be greater than 0');
                    $('.loading').hide();
                    return;
                }

                // Send prediction request
                $.ajax({
                    type: 'POST',
                    url: 'https://room-finder-dcz1.onrender.com/predict',
                    data: formData,
                    success: function (response) {
                        $('.loading').hide();
                        if (response.success) {
                            // Update result fields
                            $('#resultCity').text(response.details.city);
                            $('#resultLocation').text(response.details.location);
                            $('#resultBHK').text(response.details.bhk + ' BHK');
                            $('#resultArea').text(response.details.area + ' sq.ft');
                            $('#predictedPrice').text(response.prediction);

                            // Show result
                            $('#resultsContainer').show();
                        } else {
                            // Show error
                            alert(response.error || 'Unknown error occurred');
                        }
                    },
                    error: function (xhr, status, error) {
                        $('.loading').hide();
                        alert('An error occurred while processing your request.');
                        console.error('Prediction error:', error, xhr.responseText);
                    }
                });
            });

            // Predict Again button
            $('#predictAgainBtn').click(function () {
                $('#resultsContainer').hide();
                $('#formContainer').show();
                $('#predictionForm')[0].reset();
                $('#location').prop('disabled', true);
            });
        });
    </script>
</body>

</html>